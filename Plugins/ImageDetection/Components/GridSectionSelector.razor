@using ImageDetection.Models
@using MultiShock.PluginSdk.Components

<div class="inline-block">
    <div class="grid grid-cols-3 gap-1">
        @for (int row = 0; row < 3; row++)
        {
            @for (int col = 0; col < 3; col++)
            {
                var r = row;
                var c = col;
                var index = row * 3 + col;
                var isEnabled = Sections?.Sections[index] ?? true;
                
                <button type="button"
                        class="w-8 h-8 border border-zinc-600 cursor-pointer transition-colors duration-200 @(isEnabled ? "bg-blue-500 hover:bg-blue-400" : "bg-zinc-700 hover:bg-zinc-600")"
                        @onclick="@(() => ToggleSection(r, c))"
                        title="@($"Section {index + 1}: {(isEnabled ? "Enabled" : "Disabled")}")">
                </button>
            }
        }
    </div>
    
    <div class="flex gap-2 mt-2">
        <Button Text="All" 
                Size="xs" 
                Variant="ghost"
                OnClick="EnableAll" />
        <Button Text="None" 
                Size="xs" 
                Variant="ghost"
                OnClick="DisableAll" />
    </div>
</div>

@code {
    [Parameter] public GridSections? Sections { get; set; }
    [Parameter] public EventCallback<GridSections> SectionsChanged { get; set; }

    private async Task ToggleSection(int row, int col)
    {
        if (Sections == null) return;
        
        var index = row * 3 + col;
        Sections.Sections[index] = !Sections.Sections[index];
        await SectionsChanged.InvokeAsync(Sections);
    }

    private async Task EnableAll()
    {
        var sections = GridSections.All();
        await SectionsChanged.InvokeAsync(sections);
    }

    private async Task DisableAll()
    {
        var sections = GridSections.None();
        await SectionsChanged.InvokeAsync(sections);
    }
}
